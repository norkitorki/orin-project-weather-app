(()=>{"use strict";const t=document.querySelector(".error");function e(t,e=[]){const o=JSON.parse(String(localStorage.getItem("weather_data")));if(o){const r=document.getElementById("refresh-weather"),c=document.getElementById("convert-unit");r.parentElement.classList.remove("hidden"),t&&r.addEventListener("click",(()=>{t.call(this,localStorage.getItem("location_url"))})),c.textContent="m"===localStorage.getItem("unit")?"Metric":"Imperial",c.addEventListener("click",i);const s=o.forecast.forecastday,l=new Date(o.current.last_updated).getHours();if(e.length>0){const t=o.current.last_updated;o.current=o.forecast.forecastday[e[0]].hour[e[1]],o.current.last_updated=t}return n(o.current,o.location),function(t,e,o){const r=document.querySelector(".forecasts");let c,i,s,l;r.innerHTML="";const d=["Today","Tomorrow","In 2 days"];t.forEach(((t,u)=>{c=document.getElementById("forecast-template").content.cloneNode(!0),c.querySelector("h3").textContent=`${d[u]} (${t.date})`,t.hour.forEach(((t,r)=>{const d=c.querySelector(`.hour-${r}`);d.addEventListener("click",(()=>{n(t,o),document.querySelector(".weather-data").scrollIntoView({behavior:"smooth"})})),0===u&&(r<e?d.classList.add("passed-hour"):r===e&&d.classList.add("current-hour")),l=document.createElement("h3"),l.textContent=r,i=document.createElement("img"),i.src=`https:${t.condition.icon}`,s=document.createElement("span"),s.classList.add("temp"),a(t,s),[l,i,s].forEach((t=>d.appendChild(t)))})),r.appendChild(c)}))}(s,l,o.location),document.querySelector(".weather-data").classList.remove("hidden"),!0}return!1}function n(t,e){const n=document.querySelector(".weather-data > .current");n.innerHTML="";const o=document.getElementById("weather-template").content.cloneNode(!0),r=o.querySelector(".location-name"),i=o.querySelector(".location-time"),s=o.querySelector(".condition-icon"),l=o.querySelector(".condition"),d=o.querySelector(".last-update"),u=o.querySelector(".temperature"),m=o.querySelector(".humidity"),h=o.querySelector(".air-pressure"),p=o.querySelector(".precipitation"),y=o.querySelector(".wind"),g=o.querySelector(".wind-direction"),f=o.querySelector(".visibility");var S,w;d.textContent=JSON.parse(localStorage.getItem("weather_data")).current.last_updated.split(" ")[1],r.textContent=`${e.name} (${e.region}), ${e.country}`,i.textContent=(t.time||t.last_updated).match(/\d{2}:\d{2}$/)[0],s.src=t.condition.icon.replace(/^\/\//,"https://"),l.textContent=t.condition.text,m.textContent=`${t.humidity}%`,a(t,u),w=h,c(`${(S=t).pressure_mb} mb`,`${S.pressure_in} in`,w),function(t,e){c(`${t.precip_mm} mm`,`${t.precip_in} in`,e)}(t,p),function(t,e,n){c(`${t.wind_dir}(${t.wind_degree}deg) at ${Math.round(t.wind_kph)} kph`,`${t.wind_dir}(${t.wind_degree}deg) at ${Math.round(t.wind_mph)} mph`,e),n.setAttribute("style",`transform:rotate(${t.wind_degree}deg)`)}(t,y,g),function(t,e){c(`${t.vis_km} km`,`${t.vis_miles} miles`,e)}(t,f),n.prepend(o)}function o(t,e){const n=document.querySelector(".location-select");let o;n.innerHTML="",t.forEach((t=>{o=document.createElement("button"),o.textContent=`${t.name}(${t.region}), ${t.country}`,o.addEventListener("click",(()=>{n.innerHTML="",e&&e.call(this,t.url)})),n.appendChild(o)}))}function r(){this.classList.value="temp";const t=Number(this.dataset.m.match(/^\d+/));t>30?this.classList.add("very-hot"):t>20?this.classList.add("hot"):t<10&&this.classList.add("cold")}function a(t,e){c(`${Math.round(t.temp_c)} c°`,`${Math.round(t.temp_f)} f°`,e,[r.bind(e)])}function c(t,e,n,o=[]){n.dataset.m=t,n.dataset.i=e;const r=localStorage.getItem("unit")||"m";n.textContent=n.dataset[r],o.forEach((t=>t.call()))}function i(t){const e="m"===localStorage.getItem("unit")?"i":"m";document.querySelectorAll(`[data-${e}]`).forEach((t=>{t.textContent=t.dataset[e]})),t.target.textContent="m"===e?"Metric":"Imperial",localStorage.setItem("unit",e)}function s(e){t.textContent=e,t.classList.add("error-visible"),console.error(e)}function l(){t.classList.remove("error-visible")}localStorage.setItem("unit",localStorage.getItem("unit")||"m");const d="218a60f743ba4c51a1154257241506";async function u(t){try{const e=await fetch(t,{mode:"cors"});if(!e.ok)throw new Error("A network error has occured. Please check your internet connection and try again.");return await e.json()}catch(t){throw t}}const m=document.querySelector(".loading"),h=function(){m.classList.remove("hidden"),m.parentElement.classList.add("loading-in-progress")},p=function(){m.classList.add("hidden"),m.parentElement.classList.remove("loading-in-progress")};async function y(t){try{h();const n=await function(t,e=3){return u(`https://api.weatherapi.com/v1/forecast.json?key=${d}&q=${t}&days=${e}&aqi=no&alerts=no`)}(t);localStorage.setItem("weather_data",JSON.stringify(n)),localStorage.setItem("location_url",t),e(y),l()}catch(t){s(t.message)}finally{p()}}document.querySelector("form").addEventListener("submit",(function(t){t.preventDefault();const e=document.getElementById("location");if(!e||""===e.value)return void s("Please provide a location");const n=JSON.parse(String(localStorage.getItem("location_data"))),r=localStorage.getItem("last_query")||"";n&&n.length>1&&e.value.toLowerCase()===r.toLowerCase()?o(n,y):async function(t){try{h();const e=await function(t){return u(`https://api.weatherapi.com/v1/search.json?key=${d}&q=${t}`)}(t);0===e.length?s("Sorry, no weather for the requested location was found"):(localStorage.setItem("last_query",t),localStorage.setItem("location_data",JSON.stringify(e)),1===e.length?y(e[0].url):o(e,y),l())}catch(t){s(t.message)}finally{p()}}(e.value)})),e(y)})();