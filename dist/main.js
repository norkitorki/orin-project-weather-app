(()=>{"use strict";const t=document.querySelector(".loading"),e=function(){t.classList.remove("hidden"),t.parentElement.classList.add("loading-in-progress")},n=function(){t.classList.add("hidden"),t.parentElement.classList.remove("loading-in-progress")},o=document.querySelector(".error");function r(t,e=[]){const n=JSON.parse(String(localStorage.getItem("weather_data")));if(n){const o=document.getElementById("refresh-weather"),r=document.getElementById("convert-unit");o.parentElement.classList.remove("hidden"),t&&o.addEventListener("click",(()=>{t.call(this,localStorage.getItem("location_url"))})),r.textContent="m"===localStorage.getItem("unit")?"Metric":"Imperial",r.addEventListener("click",d);const c=n.forecast.forecastday,i=new Date(n.current.last_updated).getHours();if(e.length>0){const t=n.current.last_updated;n.current=n.forecast.forecastday[e[0]].hour[e[1]],n.current.last_updated=t}return a(n.current,n.location),function(t,e,n){const o=document.querySelector(".forecasts");let r,c,i,l;o.innerHTML="";const d=["Today","Tomorrow","In 2 days"];t.forEach(((t,u)=>{r=document.getElementById("forecast-template").content.cloneNode(!0),r.querySelector("h3").textContent=`${d[u]} (${t.date})`,t.hour.forEach(((t,o)=>{const d=r.querySelector(`.hour-${o}`);d.addEventListener("click",(()=>{a(t,n),document.querySelector(".weather-data").scrollIntoView({behavior:"smooth"})})),0===u&&(o<e?d.classList.add("passed-hour"):o===e&&d.classList.add("current-hour")),l=document.createElement("h3"),l.textContent=o,c=document.createElement("img"),c.src=`https:${t.condition.icon}`,i=document.createElement("span"),i.classList.add("temp"),s(t,i),[l,c,i].forEach((t=>d.appendChild(t)))})),o.appendChild(r)}))}(c,i,n.location),document.querySelector(".weather-data").classList.remove("hidden"),!0}return!1}function a(t,e){const n=document.querySelector(".weather-data > .current");n.innerHTML="";const o=document.getElementById("weather-template").content.cloneNode(!0),r=o.querySelector(".location-name"),a=o.querySelector(".location-time"),c=o.querySelector(".condition-icon"),i=o.querySelector(".condition"),d=o.querySelector(".last-update"),u=o.querySelector(".temperature"),m=o.querySelector(".humidity"),h=o.querySelector(".air-pressure"),p=o.querySelector(".precipitation"),y=o.querySelector(".wind"),g=o.querySelector(".wind-direction"),f=o.querySelector(".visibility");var S,w;d.textContent=JSON.parse(localStorage.getItem("weather_data")).current.last_updated.split(" ")[1],r.textContent=`${e.name} (${e.region}), ${e.country}`,a.textContent=(t.time||t.last_updated).match(/\d{2}:\d{2}$/)[0],c.src=t.condition.icon.replace(/^\/\//,"https://"),i.textContent=t.condition.text,m.textContent=`${t.humidity}%`,s(t,u),w=h,l(`${(S=t).pressure_mb} mb`,`${S.pressure_in} in`,w),function(t,e){l(`${t.precip_mm} mm`,`${t.precip_in} in`,e)}(t,p),function(t,e,n){l(`${t.wind_dir}(${t.wind_degree}deg) at ${Math.round(t.wind_kph)} kph`,`${t.wind_dir}(${t.wind_degree}deg) at ${Math.round(t.wind_mph)} mph`,e),n.setAttribute("style",`transform:rotate(${t.wind_degree}deg)`)}(t,y,g),function(t,e){l(`${t.vis_km} km`,`${t.vis_miles} miles`,e)}(t,f),n.prepend(o)}function c(t,e){const n=document.querySelector(".location-select");let o;n.innerHTML="",t.forEach((t=>{o=document.createElement("button"),o.textContent=`${t.name}(${t.region}), ${t.country}`,o.addEventListener("click",(()=>{n.innerHTML="",e&&e.call(this,t.url)})),n.appendChild(o)}))}function i(){this.classList.value="temp";const t=Number(this.dataset.m.match(/^\d+/));t>30?this.classList.add("very-hot"):t>20?this.classList.add("hot"):t<10&&this.classList.add("cold")}function s(t,e){l(`${Math.round(t.temp_c)} c°`,`${Math.round(t.temp_f)} f°`,e,[i.bind(e)])}function l(t,e,n,o=[]){n.dataset.m=t,n.dataset.i=e;const r=localStorage.getItem("unit")||"m";n.textContent=n.dataset[r],o.forEach((t=>t.call()))}function d(t){const e="m"===localStorage.getItem("unit")?"i":"m";document.querySelectorAll(`[data-${e}]`).forEach((t=>{t.textContent=t.dataset[e]})),t.target.textContent="m"===e?"Metric":"Imperial",localStorage.setItem("unit",e)}function u(t){o.textContent=t,o.classList.add("error-visible"),console.error(t)}function m(){o.classList.remove("error-visible")}localStorage.setItem("unit",localStorage.getItem("unit")||"m");const h="218a60f743ba4c51a1154257241506";async function p(t){try{const e=await fetch(t,{mode:"cors"});if(!e.ok)throw new Error("A network error has occured. Please check your internet connection and try again.");return await e.json()}catch(t){throw t}}async function y(t){try{e();const n=await function(t,e=3){return p(`https://api.weatherapi.com/v1/forecast.json?key=${h}&q=${t}&days=${e}&aqi=no&alerts=no`)}(t);localStorage.setItem("weather_data",JSON.stringify(n)),localStorage.setItem("location_url",t),r(y),m()}catch(t){u(t.message)}finally{n()}}document.querySelector("form").addEventListener("submit",(function(t){t.preventDefault();const o=document.getElementById("location");if(!o||""===o.value)return void u("Please provide a location");const r=JSON.parse(String(localStorage.getItem("location_data"))),a=localStorage.getItem("last_query")||"";r&&r.length>1&&o.value.toLowerCase()===a.toLowerCase()?c(r,y):async function(t){try{e();const n=await function(t){return p(`https://api.weatherapi.com/v1/search.json?key=${h}&q=${t}`)}(t);0===n.length?u("Sorry, no weather for the requested location was found"):(localStorage.setItem("last_query",t),localStorage.setItem("location_data",JSON.stringify(n)),1===n.length?y(n[0].url):c(n,y),m())}catch(t){u(t.message)}finally{n()}}(o.value)})),r(y)})();